# Risk of Bias plots

``` {r, echo=FALSE}
#### Delete library calls once done! ######

library(robvis)
library(knitr)
library(magrittr)
library(kableExtra)

ggplot2::ggsave(
          filename = "_figs/robplot2.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2", overall = TRUE),
          width = 8,
          height = 2.41,
          dpi = 1000
          )

```


![A finished Risk of Bias summary created using `robvis`](_figs/robplot2.png)


In this Chapter, we will describe how to create a *RevMan* style risk of bias plots in *R*.

<br></br>

## Introduction {#rob-intro}

In many Meta-Analyses, you will also want to have a look at the quality of included studies using the relevant [**domain-based risk of bias assessment tool**](https://handbook-5-1.cochrane.org/chapter_8/8_6_presentation_of_assessments_of_risk_of_bias.htm). However, many researchers don't use **RevMan** to conduct Meta-Analyses, one has to put some extra effort into inserting all study quality data by hand into RevMan, which is extremely time-consuming.

Furthermore, the quality of the Risk of Bias (RoB) summary figures in RevMan are of suboptimal picture quality. Many journals will require figures with better quality, or figures saved in another format (such as **.svg** or **.pdf**).

![This is the output created by RevMan.](_figs/robsummaryrevman.png)

To avoid all of this, you can easily plot the **RoB Summary in RStudio yourself**, using the `robvis` package.

The `robvis` package provides functions to convert a risk-of-bias assessment summary table into a summary plot or a traffic-light plot, formatted based on the specific risk-of-bias assessment tool used. 

`robvis` currently contains templates for the following tools:

* ROB2 
* ROBINS-I
* QUADAS-2
* ROB1

### Load `robvis` {#loading-robvis}

Load the `robvis` package using:

```{r, eval=FALSE}
library(robvis)
```


### Import your risk of bias summary table data

To plot produce the, we have to import our dataset first. We describe how to do this in [Chapter 3.2](#import_excel). 


Finally, the first row of the data does not contain column headings. This can be achieved using the `header = TRUE` option (which indicates that the first line contains column headings) when reading in your summary table:

``` {r, eval =FALSE}
rob <- read.csv("path/to/rob.csv", header = TRUE)
```

`robvis` expects certain facts about the data you provide it, so be sure to follow the guidance below when setting up your comma-separated-values (.csv) file:

1. The first column should contain the study identifier (e.g. **Anthony et al, 2019**)
1. The second-to-last column will contain the overall risk-of-bias judgments
1. The last column will contain the weights, which can all be set to 1 if the relevant weights are not available.
1. All other columns are expected to contain the results of the risk-of bias assessments for a specific domain. 

To elaborate on the above guidance, consider as an example the ROB2.0 tool which has 5 domains. The resulting data set that `robvis` would expect for this tool would have 8 columns, as show in Table \@ref(tab:rob-example-data):

  * Column 1: Study identifier
  * Column 2-6: One RoB2 domain per column
  * Column 7: Overall risk-of-bias judgments
  * Column 8: Weights

```{r rob-example-data, echo=FALSE}
robvis::data_rob2 %>%
  kable("html") %>%
  kable_styling(font_size = 11)
```

Note: for three of the four tool templates (ROB2, ROBINS-I, QUADAS-2), what you name columns 2-6 is not important, as the tool templates within `robvis` will relabel each domain with the correct heading.

### Example datasets
The `robvis` package contains a number of example datasets within it. The `data_rob2` data set is shown in full above (Table \@ref(tab:rob-example-data)), but the tool also contains the following example data sets:

* *data_robins*  : Example data for the ROBINS-I tool
* *data_quadas*  : Example data for the QUADAS-2 tool
* *data_rob1*    : Example data for the RoB-1 tool

You can explore these data sets using the `head()` function. For example, once you have loaded the package using `library(robvis)`, exploring the ROBINS-I example data set is as simple as running the following command:

``` {r}
head(data_robins)
```

These example datasets are used through the remainder of this guide.


## Summary plots 

### Basics

Once we haave successfully imported our risk of bias data in `R`, creating the risk of bias figures is quite straighforward. 


To get started, a simple weighted summary barplot is created using `rob_summary()`. Examples for the three main tools are shown below:

```{r, eval = FALSE}

rob_summary(data_rob2, "ROB2")

```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2"),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2.png)


```{r, eval = FALSE}
rob_summary(data_robins, tool = "ROBINS-I")
```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-robinsi.png",
          plot = robvis::rob_summary(robvis::data_robins,"ROBINS-I"),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-robinsi.png)

```{r, eval = FALSE}
rob_summary(data_quadas, tool = "QUADAS-2")
```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-quadas.png",
          plot = robvis::rob_summary(robvis::data_quadas,"QUADAS-2"),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-quadas.png)

### Modifying your summary barplot

**The `rob_summary()` function has the following parameters:**

```{r,echo=FALSE}
i<- c("data", "tool", "overall", "weighted", "colour", "quiet")

ii<-c("A dataframe containing summary (domain) level risk-of-bias assessments, with the first column containing the study details, the second column containing the first domain of your assessments, and the final column containing a weight to assign to each study. The function assumes that the data includes a column for overall risk-of-bias. For example, a ROB2.0 dataset would have 8 columns (1 for study details, 5 for domain level judgments, 1 for overall judgements, and 1 for weights, in that order).", "The risk of bias assessment tool used. RoB2.0 (tool='ROB2'), ROBINS-I (tool='ROBINS-I'), and QUADAS-2 (tool='QUADAS-2') are currently supported.", "An option to include a bar for overall risk-of-bias in the figure. Default is FALSE.", "An option to specify whether weights should be used in the barplot. Default is TRUE, in line with current Cochrane Collaboration guidance.", "An argument to specify the colour scheme for the plot. Default is 'cochrane' which used the ubiquitous Cochrane colours, while a preset option for a colour-blind friendly palette is also available (colour = 'colourblind').", "An option to quietly produce the plot without displaying it.")
ms<-data.frame(i,ii)
names<-c("Argument", "Description")
colnames(ms)<-names
kable(ms) 


```

Examples of the functionality of each argument are covered in the next section.

#### Tool



#### Overall
By default, a bar representing the overall risk-of-bias judgments is not included in the plot. If you would like to include this, set `overall = TRUE`. For example:

```{r, eval = FALSE}
rob_summary(data_rob2, tool = "ROB2", overall = TRUE)
```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-overall.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2", overall = TRUE),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-overall.png)


### Weighted or un-weighted bar plots (`weighted`)

By default, the barplot is weighted by some measure of study precision, so that the barplot shows the proportion of information rather than the proportion of studies at a particular risk of bias. This approach is in line with the [Cochrane Handbook](https://training.cochrane.org/handbook/current/chapter-07#section-7-4).

You can turn off this option by setting `weighted = FALSE`. For example, compare this plot with that produced by the based `rob_summary()` function using the `data_rob2` data set.

```{r, eval = FALSE}

rob_summary(data_rob2, "ROB2")

```

![](_figs/robsummaryplot2.png)

```{r,eval=FALSE}
rob_summary(data_rob2, tool = "ROB2", weighted = FALSE)
```


``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-unweighted.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2", weighted = FALSE),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-unweighted.png)

### Colour scheme (`colour`)

__NB: Please note the non-US English spelling of colour__

The `colour` argument of both plotting functions allows users to select from two predefined colour schemes, "cochrane" (default) or "colourblind", or to define their own palette by providing a vector of hex codes.

For example, to use the predefined "colourblind" palette:

```{r, eval = FALSE}
rob_summary(data = data_rob2, tool = "ROB2", colour = "colourblind")
```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-colourblind.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2", colour = "colourblind"),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-colourblind.png)


And to define your own colour scheme:
```{r, eval = FALSE}
rob_summary(data = data_rob2, tool = "ROB2", colour = c("#f442c8","#bef441","#000000"))
```

``` {r, echo=FALSE}
ggplot2::ggsave(
          filename = "_figs/robsummaryplot2-customcolour.png",
          plot = robvis::rob_summary(robvis::data_rob2,"ROB2", colour = c("#f442c8","#bef441","#000000")),
          width = 8,
          height = 2.41,
          dpi = 1000
          )
```

![](_figs/robsummaryplot2-customcolour.png)

When defining your own colour scheme, you must ensure that the number of discrete judgments (e.g. "Low"/"Moderate"/"High"/"Critical") and the number of colours specified are the same. Additionally, colours must be specified in order of ascending risk-of-bias (e.g. "Low" -> "Critical"), with the first hex corresponding to "Low" risk of bias.

### Saving the summary plot

#### Sizing the plot

When saving the summary barplot, we recommend using the following code, with the default height and widths. 

``` {r, eval = FALSE}
library(ggplot2)

rob_plot <- rob_summary(data_rob2, "ROB2")

ggsave(plot = rob_plot,                     # Plot to save
       filename = "_figs/robplot2.png",     # Destination file
       width = 8,                           # Width of image 
       height = 2.41,                       # Height of image
       dpi = 1000                           # Resolution of image
       )
```


#### Saving in different formats

The plot can be saved in a range of formats using the command above, simply by changing the extension of the filename (e.g. from "*.png*" to "*.pdf*"). Aceeptible formats included:

* .png
* .pdf
* .tiff
* .svg ^[This format requires you to install and load the `svglite` package: `install.packages("svglite"); library(svglite)`]


## "Traffic light" plots
### Basics

```{r, eval = FALSE}

rob_traffic_light(data_rob2, "ROB2")

```

``` {r, echo = FALSE}
ggplot2::ggsave(
          filename = "_figs/robtfplot2.png",
          plot = robvis::rob_traffic_light(robvis::data_rob2, "ROB2", psize = 5),
          width = 7,
          height = 10,
          dpi = 1000
          )
```

![](_figs/robtfplot2.png)

### Modifications
### Saving

## Web app

In an effort users to explore the `robvis` package, a online implementation was created. 
















